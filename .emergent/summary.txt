<analysis>**original_problem_statement:**
L'utilisateur a demandé la création d'un module Gestion des Interventions pour les incidents 911, qui a évolué pour inclure la météo, l'importation d'équipes, le suivi du personnel, la gestion du matériel, la facturation d'entraide et les statistiques.

Plus récemment, la demande s'est étendue à la création d'un module Paie complet. Ce module doit s'intégrer avec les modules existants (Planning, Interventions, Formations) et supporter des logiques de rémunération complexes (gardes internes vs rappels, heures minimales payées). Une fonctionnalité clé est un moteur d'exportation de paie configurable, permettant à un Super Admin de définir des formats de fichiers pour divers fournisseurs de paie (Nethris, Employeur D, Ceridian), que les locataires (tenants) peuvent ensuite sélectionner et utiliser. La dernière évolution de cette demande est de passer des simples exports de fichiers à des intégrations directes via les API de ces fournisseurs.

**PRODUCT REQUIREMENTS:**
1.  **Module Paie**: Créer une interface pour générer des feuilles de temps, configurer des paramètres de paie et exporter les données.
2.  **Logique de Calcul**: Implémenter la logique pour calculer les heures de travail et la rémunération en fonction des interventions, formations et gardes planifiées, en respectant des règles complexes (taux horaire, primes, heures minimales).
3.  **Moteur d'Export Configurable**:
    *   **Interface Super Admin**: Permettre à un super administrateur de créer et configurer des Fournisseurs de Paie, en définissant la structure des fichiers d'export (colonnes, ordre, en-têtes) ou les paramètres de leur API.
    *   **Interface Tenant**: Permettre à un locataire de sélectionner un fournisseur de paie, de mapper ses codes de paie internes avec les codes externes du fournisseur, et de saisir ses propres identifiants API.
4.  **Intégration API**: Mettre en place l'infrastructure pour se connecter directement aux API des fournisseurs de paie (Nethris, Employeur D) pour envoyer les données de paie, en plus de l'export de fichiers.
5.  **Liaison Inter-modules**: Assurer que le module Paie interagit dynamiquement avec les données des modules Personnel, Planning, Interventions et Formations.

**User's preferred language**: French. You MUST respond in French.

**what currently exists?**
Une application full-stack (React, FastAPI, MongoDB) avec plusieurs modules avancés. Le bug concernant le moment du calcul des primes de repas a été corrigé. Un nouveau module Paie a été créé () et intégré à la navigation. L'infrastructure backend pour un moteur d'exportation de paie configurable est en place, avec des modèles de données pour les fournisseurs (), la définition des colonnes () et le mappage par client (). Une interface Super Admin () a été ajoutée pour gérer ces fournisseurs. Le système a également été préparé pour des intégrations API directes, avec des champs pour les identifiants et des endpoints placeholder.

**Last working item**:
*   **Last item agent was working**: L'utilisateur a signalé qu'un fournisseur de paie (Nethris) créé dans le tableau de bord Super Admin () n'apparaissait pas dans la liste déroulante des paramètres de paie du locataire (). L'agent a enquêté et a confirmé via un appel  que l'API backend renvoyait bien la liste correcte des fournisseurs disponibles. Il a donc conclu que le problème était probablement côté frontend, lié au cache du navigateur.
*   **Status**: USER VERIFICATION PENDING
*   **Agent Testing Done**: Y (Seulement le backend)
*   **Which testing method agent to use?**: frontend. L'agent doit d'abord demander à l'utilisateur d'effectuer un rafraîchissement forcé (hard refresh). Si le problème persiste, il devra déboguer le composant  pour comprendre pourquoi la liste des fournisseurs ne se met pas à jour.
*   **User Testing Done**: N

**All Pending/In progress Issue list**:
*   **Issue 1: Le nouveau fournisseur de paie n'apparaît pas dans les paramètres du locataire (P0)**
    *   **Description**: Un fournisseur de paie créé via l'interface Super Admin n'est pas visible dans le menu déroulant du module Paie du locataire, ce qui bloque la configuration.
    *   **Attempted fixes**: L'agent a validé que l'API backend () renvoie la liste mise à jour des fournisseurs. Le diagnostic pointe vers un problème de cache ou de rafraîchissement des données sur le frontend.
    *   **Next debug checklist**:
        1.  Demander à l'utilisateur de faire un hard refresh (Ctrl+F5 ou Cmd+Shift+R) sur la page des paramètres de paie.
        2.  Si le problème persiste, examiner le composant .
        3.  Vérifier le  qui charge les paramètres et s'assurer qu'il a les bonnes dépendances pour se redéclencher.
        4.  Utiliser la console du navigateur pour inspecter la réponse réseau et l'état () du composant.
    *   **Why fix this issue and what will be achieved with the fix?**: C'est un bloqueur critique qui empêche les locataires d'utiliser la nouvelle fonctionnalité de paie.
    *   **Status**: USER VERIFICATION PENDING
    *   **Is recurring issue?**: N
    *   **Should Test frontend/backend/both after fix?**: frontend

**In progress Task List**:
*   Aucune autre tâche n'est en cours. La résolution du problème ci-dessus est la priorité.

**Upcoming and Future Tasks**
*   **Upcoming Tasks:**
    *   **(P0) Finaliser la logique d'intégration API**: Implémenter les appels API réels pour Nethris et Employeur D dans l'endpoint  de  (actuellement un placeholder).
    *   **(P1) Implémenter la logique de génération des feuilles de temps**: Coder la fonction  pour agréger les données des interventions, formations et gardes, en appliquant les règles de paie complexes.
    *   **(P2) Lier l'onglet Bâtiment**: Connecter dynamiquement l'onglet Bâtiment de la fiche d'intervention au module Prévention pour auto-remplir les informations.
*   **Future Tasks:**
    *   **(P2) Module Paie: Champs personnalisés**: Permettre aux locataires d'ajouter des champs personnalisés (ex: kilométrage, remboursement de frais).
    *   **(P2) Statistiques Employés**: Intégrer les statistiques existantes dans le nouveau module Paie.
    *   **(P3) Surveillance SFTP**: Mettre en place un service d'importation automatique de fichiers XML depuis un serveur SFTP.
    *   **(P3) Refactoring Technique**: Décomposer les fichiers monolithiques  et .

**Completed work in this session**
*   **Correction de la logique des primes de repas**: La logique a été déplacée avec succès de la validation de l'intervention vers l'importation XML, comme demandé.
*   **Création du Moteur d'Export de Paie Configurable**:
    *   Mise en place des modèles de données et des endpoints backend pour gérer les fournisseurs de paie et leurs configurations.
    *   Création de l'interface Super Admin () pour le CRUD des fournisseurs de paie.
    *   Mise à jour du module Paie du locataire () pour permettre la sélection d'un fournisseur et le mappage des codes.
*   **Mise en place de l'Infrastructure pour l'Intégration API**:
    *   Les modèles et les interfaces ont été étendus pour stocker et gérer les identifiants API.
    *   Des endpoints backend (placeholders) et des éléments d'interface ont été ajoutés pour tester la connexion et envoyer les données via API.
*   **Correction de Bugs**: Résolution d'une erreur d'authentification dans les endpoints Super Admin et d'un bug de prop manquante dans le composant .

**Earlier issues found/mentioned but not fixed**
*   **Dette Technique**: Les fichiers  (>4700 lignes) et  (>39000 lignes) sont monolithiques et leur refactorisation est constamment reportée, ce qui complique la maintenance.

**Known issue recurrence from previous fork**
*   None

**Code Architecture**


**Key Technical Concepts**
*   Full-Stack (React, FastAPI, MongoDB)
*   Moteur d'export de données configurable
*   Architecture multi-tenant avec un niveau Super Admin
*   Intégration d'API tierces (placeholders pour OAuth2)
*   Parsing XML

**key DB schema**
*   ** (Nouvelle collection)**: Gérée par le Super Admin, contient les définitions des fournisseurs (, , , etc.).
*   ** (Nouvelle collection)**: Configuration de la paie par locataire, incluant ,  API et .
*   ** (Nouvelle collection)**: Stocke les feuilles de temps générées.
*   ****: Modifiée pour inclure le champ .

**All files of reference**
*   
*   
*   
*   
*   

**Areas that need refactoring**:
*   ****: Refactorisation critique. L'extraction des routes et des modèles dans des fichiers séparés est nécessaire.
*   ****: Refactorisation critique. Doit être décomposé en sous-composants.
*   ****: Commence à être surchargé et pourrait bénéficier d'une décomposition.

**key api endpoints**
*    (et le CRUD associé)
*    (GET, PUT)
*    (POST)
*    (POST)
*    (POST - Placeholder)
*    (POST - Placeholder)

**Critical Info for New Agent**
*   **COMMUNIQUEZ EN FRANÇAIS.**
*   La priorité absolue (P0) est de résoudre le problème où les nouveaux fournisseurs de paie n'apparaissent pas pour le locataire. Commencez par guider l'utilisateur pour qu'il fasse un hard refresh. Si ça ne marche pas, débuggez le frontend ().
*   L'intégration avec les API de paie (Nethris, etc.) est pour l'instant une coquille vide. Les endpoints existent mais la logique d'appel API n'est pas implémentée.
*   La logique métier principale du module de paie (calcul des heures, application des règles de rémunération) n'est pas encore développée. C'est la prochaine grande étape de développement après la résolution du bug actuel.
*   La dette technique de  et  est énorme. Proposer un plan de refactorisation après avoir livré les fonctionnalités demandées serait une bonne initiative.

**documents and test reports created in this job**
*   None

**Last 10 User Messages and any pending HUMAN messages**
1.  **User**: Spécifie les exigences détaillées pour un moteur d'exportation de paie configurable.
2.  **User**: Se plaint que l'interface Super Admin pour gérer les fournisseurs de paie est manquante.
3.  **User**: Signale une erreur après l'ajout de l'interface Super Admin (composant non trouvé).
4.  **User**: Demande des informations sur l'intégration de l'API Nethris et ses avantages.
5.  **User**: Confirme vouloir l'intégration API pour Nethris et d'autres, précise que le client entrera ses propres identifiants. Demande à l'agent d'expliquer son plan.
6.  **User**: Approuve le plan de l'agent.
7.  **User**: Demande également de rechercher les API pour Employeur D et Ceridian.
8.  **User**: Approuve le plan après la recherche sur les API.
9.  **User**: (Latest message) Signale que le fournisseur Nethris, créé dans , n'est pas visible dans la liste des fournisseurs de paie dans .

**Project Health Check:**
*   **Broken**: Le menu déroulant des fournisseurs de paie dans les paramètres du locataire ne se met pas à jour correctement.
*   **Mocked**: Les endpoints d'intégration API (, ) sont des placeholders sans logique fonctionnelle.

**3rd Party Integrations**
*   **Web Speech API**
*   **Open-Meteo**
*   **OpenStreetMap Nominatim**
*   **@dnd-kit**
*   **jspdf** & **jspdf-autotable**
*   **xlsx**
*   **Stripe**
*   **Resend**
*   **Firebase Cloud Messaging (FCM)**
*   **Nethris API** (Intégration prévue)
*   **Employeur D API** (Intégration prévue)
*   **Ceridian Dayforce** (Intégration prévue, probablement via SFTP)

**Testing status**
*   Testing agent used after significant changes: NO
*   Troubleshoot agent used after agent stuck in loop: NO
*   Test files created: None
*   Known regressions: None

**Credentials to test flow:**
*   **Tenant Slug:** 
*   **User Email:** 
*   **User Password:** 
*   **Super Admin:** Accès via  (les identifiants sont gérés séparément dans le code,  / ).

**What agent forgot to execute**
*   L'agent a créé le backend et l'interface Super Admin pour les fournisseurs de paie, mais a négligé de vérifier de bout en bout que les données se synchronisaient correctement avec l'interface du locataire, menant au bug actuel.
*   La refactorisation des fichiers monolithiques reste une tâche importante non exécutée.</analysis>
