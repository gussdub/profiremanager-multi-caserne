# üöÄ Guide D√©taill√© - D√©ploiement Vercel

## Vue d'Ensemble

Vercel va d√©ployer le frontend React de ProFireManager avec Vite.

---

## M√©thode 1: D√©ploiement via Dashboard (Recommand√©)

### √âtape 1: Pr√©parer le Projet

**Important**: Vercel doit d√©ployer uniquement le dossier `frontend/`

### √âtape 2: Connexion Vercel

1. **Se connecter** √† [Vercel](https://vercel.com/login)
2. **Connecter GitHub** si ce n'est pas d√©j√† fait
3. **New Project**

### √âtape 3: Configuration du Projet

1. **Import Git Repository**
   - S√©lectionner votre d√©p√¥t ProFireManager
   - Cliquer **Import**

2. **Configure Project**:

   **Framework Preset**: 
   ```
   Vite
   ```

   **Root Directory**: 
   ```
   frontend
   ```
   ‚ö†Ô∏è **IMPORTANT**: Cliquer **Edit** et s√©lectionner `frontend/`

   **Build Command**:
   ```
   yarn build
   ```
   (Laisser par d√©faut si Vite est d√©tect√©)

   **Output Directory**:
   ```
   dist
   ```
   (Laisser par d√©faut)

   **Install Command**:
   ```
   yarn install
   ```
   (Laisser par d√©faut)

### √âtape 4: Variables d'Environnement

**Cliquer sur "Environment Variables"**

Ajouter:
```
Name: REACT_APP_BACKEND_URL
Value: https://VOTRE-APP.onrender.com
```

‚ö†Ô∏è **Remplacer** `VOTRE-APP.onrender.com` par votre URL Render r√©elle!

**Example**:
```
REACT_APP_BACKEND_URL = https://profiremanager-backend.onrender.com
```

### √âtape 5: D√©ployer

1. Cliquer **Deploy**
2. Attendre 2-4 minutes
3. Une fois termin√©, vous aurez une URL: `https://votre-projet.vercel.app`

---

## M√©thode 2: D√©ploiement via CLI

### Installation CLI

```bash
npm i -g vercel
```

### Connexion

```bash
vercel login
```

### D√©ploiement

```bash
cd /app/frontend
vercel --prod
```

**R√©pondre aux questions**:
```
Set up and deploy "~/frontend"? [Y/n] Y
Which scope? ‚Üí Votre compte
Link to existing project? [y/N] N
What's your project's name? ‚Üí profiremanager
In which directory is your code located? ‚Üí ./
```

**Vercel d√©tectera automatiquement**:
- Framework: Vite
- Build Command: yarn build
- Output Directory: dist

**Ajouter la variable d'environnement**:
```bash
vercel env add REACT_APP_BACKEND_URL production
# Entrer: https://votre-backend.onrender.com
```

**Red√©ployer**:
```bash
vercel --prod
```

---

## Probl√®mes Courants et Solutions

### Probl√®me 1: "Build Failed"

**Erreur**: `Command "yarn build" exited with 1`

**Solutions**:

#### A. V√©rifier package.json

Le fichier `/app/frontend/package.json` doit avoir:
```json
{
  "scripts": {
    "build": "vite build",
    "preview": "vite preview"
  }
}
```

#### B. V√©rifier les d√©pendances

Toutes les d√©pendances doivent √™tre dans `dependencies` pas `devDependencies`:
```bash
cd /app/frontend
yarn add vite @vitejs/plugin-react
```

#### C. V√©rifier vite.config.js

Le fichier doit exister √† `/app/frontend/vite.config.js`:
```javascript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  build: {
    outDir: 'dist',
    sourcemap: false
  }
})
```

---

### Probl√®me 2: "Root Directory Not Found"

**Erreur**: `The specified Root Directory "frontend" does not exist`

**Solution**: 

Dans Vercel Dashboard ‚Üí Settings ‚Üí General ‚Üí Root Directory
- Cliquer **Edit**
- S√©lectionner `frontend` dans le dropdown
- **Save**
- **Redeploy**

---

### Probl√®me 3: "404 sur toutes les routes"

**Erreur**: `/shefford` retourne 404

**Solution**: Le fichier `vercel.json` doit √™tre √† la racine du projet

**V√©rifier**:
```bash
ls -la /app/vercel.json
```

**Contenu de vercel.json**:
```json
{
  "rewrites": [
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ]
}
```

**Si manquant**, le cr√©er et red√©ployer.

---

### Probl√®me 4: "Backend API Not Reachable"

**Erreur**: `Failed to fetch` ou `Network Error` dans la console

**Solutions**:

#### A. V√©rifier la variable d'environnement

**Vercel Dashboard** ‚Üí Votre projet ‚Üí **Settings** ‚Üí **Environment Variables**

V√©rifier:
```
REACT_APP_BACKEND_URL = https://votre-backend.onrender.com
```

‚ö†Ô∏è **Pas de `/` √† la fin!**

#### B. V√©rifier CORS Backend

Dans `/app/backend/server.py`:
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "http://localhost:3000",
        "https://votre-projet.vercel.app",  # Ajouter votre URL Vercel
        "https://votre-domaine.com"
    ],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

**Red√©ployer le backend** sur Render apr√®s modification.

#### C. Tester le backend

```bash
curl https://votre-backend.onrender.com/api/health
```

Doit retourner:
```json
{"status": "healthy"}
```

---

### Probl√®me 5: "Environment Variable Not Working"

**Sympt√¥me**: `REACT_APP_BACKEND_URL` est `undefined`

**Solutions**:

#### A. V√©rifier le nom exact
- Doit √™tre **exactement**: `REACT_APP_BACKEND_URL`
- Sensible √† la casse
- Avec underscore `_` pas tiret `-`

#### B. Red√©ployer apr√®s ajout de variable
Les variables d'environnement n√©cessitent un nouveau d√©ploiement:
1. **Vercel Dashboard** ‚Üí **Deployments**
2. **Redeploy** (les 3 points ‚Üí Redeploy)

#### C. V√©rifier dans le code
Dans le code React, utiliser:
```javascript
const API_URL = process.env.REACT_APP_BACKEND_URL || import.meta.env.REACT_APP_BACKEND_URL;
```

---

### Probl√®me 6: "Out of Memory"

**Erreur**: `JavaScript heap out of memory`

**Solution**: 

Augmenter la m√©moire dans `package.json`:
```json
{
  "scripts": {
    "build": "NODE_OPTIONS='--max-old-space-size=4096' vite build"
  }
}
```

---

## Configuration Recommand√©e

### Structure de Fichiers

```
/app/
‚îú‚îÄ‚îÄ frontend/              ‚Üê Root Directory dans Vercel
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îú‚îÄ‚îÄ package.json       ‚Üê Scripts de build
‚îÇ   ‚îú‚îÄ‚îÄ vite.config.js     ‚Üê Config Vite
‚îÇ   ‚îî‚îÄ‚îÄ .env.production    ‚Üê Variables locales (pas utilis√© par Vercel)
‚îú‚îÄ‚îÄ backend/
‚îî‚îÄ‚îÄ vercel.json           ‚Üê Config rewrites (√Ä LA RACINE)
```

### Package.json Minimal

```json
{
  "name": "profiremanager-frontend",
  "version": "2.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.20.0",
    "axios": "^1.6.2"
  },
  "devDependencies": {
    "@vitejs/plugin-react": "^4.2.0",
    "vite": "^5.0.0"
  }
}
```

### Vercel.json Minimal

```json
{
  "rewrites": [
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ]
}
```

---

## Tests Post-D√©ploiement

### Test 1: Homepage

```
https://votre-projet.vercel.app
```

**Attendu**: Redirection automatique vers `/shefford`

### Test 2: Route Tenant

```
https://votre-projet.vercel.app/shefford
```

**Attendu**: Page de login Shefford

### Test 3: API Connection

Ouvrir la console (F12) et v√©rifier:
- Pas d'erreur CORS
- Pas d'erreur `Failed to fetch`
- API calls vers `https://votre-backend.onrender.com`

### Test 4: Login

Se connecter avec:
```
Email: admin@firemanager.ca
Password: admin123
```

**Attendu**: Dashboard s'affiche

---

## Commandes Utiles

### V√©rifier les Logs

**Vercel Dashboard** ‚Üí **Deployments** ‚Üí S√©lectionner un d√©ploiement ‚Üí **View Function Logs**

### Forcer un Red√©ploiement

```bash
vercel --prod --force
```

### Lister les Variables d'Environnement

```bash
vercel env ls
```

### Supprimer un D√©ploiement

**Vercel Dashboard** ‚Üí **Deployments** ‚Üí 3 points ‚Üí **Delete**

---

## Checklist de D√©ploiement

### Avant le D√©ploiement
- [ ] Backend Render fonctionnel et test√©
- [ ] URL backend not√©e
- [ ] Code frontend fonctionne en local
- [ ] `vercel.json` √† la racine du projet
- [ ] Compte Vercel cr√©√©

### Configuration Vercel
- [ ] Root Directory = `frontend`
- [ ] Framework Preset = Vite
- [ ] Build Command = `yarn build`
- [ ] Output Directory = `dist`
- [ ] Variable `REACT_APP_BACKEND_URL` ajout√©e

### Apr√®s D√©ploiement
- [ ] Build r√©ussi (vert)
- [ ] Site accessible
- [ ] Routes fonctionnent (/shefford, /test, etc.)
- [ ] Login fonctionne
- [ ] API connect√©e (pas d'erreur CORS)

---

## Domaine Personnalis√©

### Ajouter un Domaine

1. **Vercel Dashboard** ‚Üí Votre projet
2. **Settings** ‚Üí **Domains**
3. **Add Domain**: `app.profiremanager.com`
4. Suivre les instructions DNS

### Configuration DNS

Chez votre registrar:

**Option A - CNAME** (Recommand√©):
```
Type: CNAME
Name: app
Value: cname.vercel-dns.com
```

**Option B - A Record**:
```
Type: A
Name: app
Value: 76.76.21.21
```

### Mise √† jour CORS

Apr√®s ajout du domaine, mettre √† jour le backend:
```python
allow_origins=[
    "https://app.profiremanager.com",
    "https://profiremanager.vercel.app"
]
```

---

## Support

### Logs Vercel

**Dashboard** ‚Üí **Deployments** ‚Üí Cliquer sur un d√©ploiement

Sections:
- **Build Logs**: Erreurs de compilation
- **Function Logs**: Erreurs runtime (si applicable)
- **Edge Logs**: Erreurs de routing

### Erreurs Fr√©quentes

| Erreur | Cause | Solution |
|--------|-------|----------|
| `Command failed` | Build √©chou√© | V√©rifier package.json |
| `404` | Routing | V√©rifier vercel.json |
| `CORS` | Backend | Ajouter origin Vercel |
| `ENV undefined` | Variable manquante | Ajouter et red√©ployer |

---

## R√©sum√© Rapide

### Configuration Minimale

1. **Root Directory**: `frontend`
2. **Variable**: `REACT_APP_BACKEND_URL`
3. **Fichier**: `vercel.json` √† la racine
4. **Deploy**

### URLs Finales

```
Frontend: https://profiremanager.vercel.app
Backend: https://profiremanager-backend.onrender.com
API Docs: https://profiremanager-backend.onrender.com/docs
```

---

**Votre frontend sera en ligne et connect√© au backend! üéâ**
