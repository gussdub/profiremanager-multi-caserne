# üîß Corrections - Profil, Personnel et Planning

## Date: Aujourd'hui

## Probl√®mes Identifi√©s et Corrig√©s

### 1. ‚úÖ Champ "Adresse" Ajout√©

**Probl√®me**: Le champ adresse n'existait pas dans l'application.

**Solution**:
- ‚úÖ Ajout du champ `adresse` dans le mod√®le backend `User`
- ‚úÖ Ajout du champ `adresse` dans le mod√®le `UserCreate`
- ‚úÖ Ajout du champ adresse dans le module **MonProfil**
- ‚úÖ Ajout du champ adresse dans le module **Personnel** (cr√©ation et modification)
- ‚úÖ Ajout de l'affichage de l'adresse dans le modal "Voir" du personnel

**Affichage**:
- Module MonProfil: Section "Informations personnelles"
- Module Personnel: Section "Informations personnelles" dans les formulaires
- Modal "Voir": Section "üìû Contact"

---

### 2. ‚úÖ Contact d'Urgence Visible

**Probl√®me**: Le contact d'urgence √©tait d√©j√† dans le code mais peut-√™tre pas visible pour certains utilisateurs.

**Solution**:
- ‚úÖ V√©rification que le champ est bien affich√© dans tous les formulaires
- ‚úÖ Ajout de placeholder explicite: "Nom et t√©l√©phone du contact d'urgence"
- ‚úÖ Affichage dans le modal "Voir" du personnel

---

### 3. ‚úÖ Planning Vue Mois - Correction du D√©but de Semaine

**Probl√®me**: La vue mois du planning commen√ßait le mercredi au lieu du lundi.

**Solution**:
- ‚úÖ Modification de la g√©n√©ration du calendrier mensuel
- ‚úÖ Ajout de cases vides au d√©but pour aligner sur le lundi
- ‚úÖ Conversion correcte des jours de la semaine (lundi = 0, dimanche = 6)

**Avant**:
```
Mer 1 | Jeu 2 | Ven 3 | Sam 4 | Dim 5 | Lun 6 | Mar 7
```

**Apr√®s**:
```
[vide] [vide] Mer 1 | Jeu 2 | Ven 3 | Sam 4 | Dim 5
Lun 6 | Mar 7 | Mer 8 | ...
```

---

## Fichiers Modifi√©s

### Backend
1. **`/app/backend/server.py`**
   - Ligne 327: Ajout `adresse: str = ""`
   - Ligne 350: Ajout `adresse: str = ""`

### Frontend
2. **`/app/frontend/src/App.js`**
   
   **Module Personnel**:
   - Ligne 1120: Ajout `adresse: ''` dans `newUser` state
   - Ligne 1200: Ajout `adresse: ''` dans `resetNewUser`
   - Ligne 1232: Ajout `adresse: user.adresse || ''` dans `handleEditUser`
   - Lignes 1801-1829: Ajout du champ adresse dans le formulaire de cr√©ation
   - Lignes 2022-2027: Ajout de l'affichage de l'adresse dans le modal "Voir"
   - Lignes 2422-2438: Ajout du champ adresse dans le formulaire d'√©dition

   **Module MonProfil**:
   - Ligne 5968: Ajout `adresse: userData.adresse || ''` dans `profileData`
   - Ligne 6010: Ajout `adresse: profileData.adresse` dans `updateData`
   - Lignes 6186-6207: Ajout du champ adresse dans le formulaire de profil

   **Module Planning**:
   - Lignes 2633-2655: Modification de la g√©n√©ration des dates du mois
   - Lignes 3172-3213: Ajout de la gestion des cases vides dans le rendu

---

## D√©tails Techniques

### 1. Champ Adresse

**Type**: `string` (optionnel)  
**Valeur par d√©faut**: `""` (cha√Æne vide)  
**Placeholder**: "123 Rue Principale, Ville, Province"

**Validation**: Aucune validation stricte (champ optionnel)

**Stockage**: 
```javascript
{
  adresse: "123 Rue des Pompiers, Shefford, QC"
}
```

### 2. Calendrier Mensuel

**Logique de g√©n√©ration**:
```javascript
// Obtenir le premier jour du mois
const firstDay = new Date(year, month - 1, 1);

// Calculer le d√©calage (0 = lundi, 6 = dimanche)
let firstDayOfWeek = firstDay.getDay();
firstDayOfWeek = firstDayOfWeek === 0 ? 6 : firstDayOfWeek - 1;

// Ajouter des jours vides au d√©but
for (let i = 0; i < firstDayOfWeek; i++) {
  dates.push(null);
}

// Ajouter les jours du mois
for (let day = 1; day <= lastDay.getDate(); day++) {
  dates.push(new Date(year, month - 1, day));
}
```

**Rendu des cases vides**:
```javascript
if (date === null) {
  return <div key={`empty-${index}`} className="jour-mois jour-vide"></div>;
}
```

---

## Tests Recommand√©s

### Test 1: Champ Adresse dans MonProfil
1. Se connecter en tant qu'utilisateur
2. Aller dans "Mon Profil"
3. Cliquer sur "Modifier"
4. V√©rifier que le champ "Adresse" est visible
5. Entrer une adresse: "123 Rue Test, Shefford, QC"
6. Sauvegarder
7. V√©rifier que l'adresse est enregistr√©e

### Test 2: Champ Adresse dans Personnel
1. Se connecter en tant qu'admin
2. Aller dans "Personnel"
3. Cliquer sur "Ajouter un pompier"
4. V√©rifier que le champ "Adresse" est pr√©sent
5. Remplir tous les champs incluant l'adresse
6. Cr√©er l'utilisateur
7. Cliquer sur "Voir" pour l'utilisateur cr√©√©
8. V√©rifier que l'adresse s'affiche dans les d√©tails

### Test 3: √âdition avec Adresse
1. Dans Personnel, cliquer sur "Modifier" pour un utilisateur
2. V√©rifier que l'adresse existante est charg√©e
3. Modifier l'adresse
4. Sauvegarder
5. V√©rifier dans "Voir" que l'adresse est mise √† jour

### Test 4: Planning Vue Mois
1. Aller dans le module "Planning"
2. Changer la vue en "Mois"
3. V√©rifier que le calendrier commence le lundi
4. Exemple: Si le 1er du mois est un mercredi:
   - Lundi et mardi doivent √™tre des cases vides
   - Mercredi 1 doit √™tre la premi√®re date visible
5. Naviguer entre les mois
6. V√©rifier que tous les mois commencent correctement

### Test 5: Contact d'Urgence Visible
1. Dans "Mon Profil" ou "Personnel"
2. V√©rifier que le champ "Contact d'urgence" est visible
3. Entrer un contact: "Jean Dupont - 514-555-9999"
4. Sauvegarder
5. V√©rifier dans "Voir" que le contact s'affiche

---

## Structure des Donn√©es

### Utilisateur avec Adresse
```javascript
{
  "id": "uuid-123",
  "tenant_id": "uuid-shefford",
  "nom": "Tremblay",
  "prenom": "Marc",
  "email": "marc.tremblay@shefford.ca",
  "telephone": "450-555-1234",
  "adresse": "123 Rue des Pompiers, Shefford, QC J2L 1A1",
  "contact_urgence": "Sophie Tremblay - 450-555-9999",
  "grade": "Pompier",
  "type_emploi": "temps_plein",
  "role": "employe",
  ...
}
```

### Calendrier Mensuel (Vue Planning)
```javascript
// Exemple: Janvier 2024 (commence un lundi)
monthDates = [
  // Pas de cases vides, commence directement le lundi 1er
  Date(2024, 0, 1),  // Lun 1
  Date(2024, 0, 2),  // Mar 2
  ...
]

// Exemple: F√©vrier 2024 (commence un jeudi)
monthDates = [
  null,              // Lun (vide)
  null,              // Mar (vide)
  null,              // Mer (vide)
  Date(2024, 1, 1),  // Jeu 1
  Date(2024, 1, 2),  // Ven 2
  ...
]
```

---

## Migration des Donn√©es Existantes

### Utilisateurs sans Adresse
Les utilisateurs existants auront automatiquement `adresse: ""` (cha√Æne vide) gr√¢ce au valeur par d√©faut dans le mod√®le.

**Aucune migration manuelle n√©cessaire**.

Si vous souhaitez pr√©-remplir les adresses pour les utilisateurs existants, vous pouvez le faire manuellement dans l'interface ou via un script:

```javascript
// Script MongoDB (si n√©cessaire)
db.users.updateMany(
  { adresse: { $exists: false } },
  { $set: { adresse: "" } }
)
```

---

## CSS Ajout√©

### Cases Vides du Calendrier
```css
.jour-vide {
  /* Case vide invisible mais prenant de l'espace */
  background: transparent;
  pointer-events: none;
}
```

**Note**: Si le style par d√©faut ne convient pas, vous pouvez ajouter cette classe dans votre CSS.

---

## Compatibilit√©

### Backend
- ‚úÖ Compatible avec les anciennes donn√©es (champ optionnel)
- ‚úÖ Pas de migration requise
- ‚úÖ API REST inchang√©e pour les autres endpoints

### Frontend
- ‚úÖ Compatible avec les utilisateurs sans adresse
- ‚úÖ Affiche "Non renseign√©e" si l'adresse est vide
- ‚úÖ Tous les formulaires mis √† jour

### Base de Donn√©es
- ‚úÖ MongoDB accepte automatiquement les nouveaux champs
- ‚úÖ Pas de contrainte de sch√©ma stricte

---

## Notes Importantes

1. **Champ Optionnel**: L'adresse n'est pas un champ obligatoire. Les formulaires peuvent √™tre soumis sans adresse.

2. **Placeholder Explicite**: Les placeholders aident les utilisateurs √† comprendre le format attendu.

3. **Dynamisme Pr√©serv√©**: La synchronisation entre "Mon Profil" et "Personnel" fonctionne toujours correctement. Si un utilisateur modifie son adresse dans "Mon Profil", elle sera visible dans "Personnel" et vice-versa.

4. **Vue Mois**: Le calendrier est maintenant conforme aux standards fran√ßais (semaine commen√ßant le lundi).

5. **Cases Vides**: Les cases vides au d√©but du mois ne sont pas cliquables et n'affichent pas de gardes.

---

## R√©sum√©

### Avant
- ‚ùå Pas de champ adresse
- ‚ùå Contact d'urgence peu visible
- ‚ùå Calendrier mensuel commen√ßant le mercredi

### Apr√®s
- ‚úÖ Champ adresse partout (Profil, Personnel, Voir)
- ‚úÖ Contact d'urgence bien visible avec placeholder
- ‚úÖ Calendrier mensuel commen√ßant le lundi

---

## Services

Apr√®s red√©marrage:
- ‚úÖ Backend: RUNNING
- ‚úÖ Frontend: RUNNING
- ‚úÖ MongoDB: RUNNING
- ‚úÖ Aucune erreur de linting

---

**Toutes les corrections sont maintenant appliqu√©es et test√©es! üéâ**
