#!/usr/bin/env python3
"""Script pour nettoyer TOUTES les assignations et recommencer"""

import asyncio
from motor.motor_asyncio import AsyncIOMotorClient
import os
from dotenv import load_dotenv

load_dotenv('/app/backend/.env')

async def clean_all_assignations():
    MONGO_URL = os.environ.get('MONGO_URL')
    client = AsyncIOMotorClient(MONGO_URL)
    db = client.firemanager_db
    
    print("=" * 80)
    print("NETTOYAGE COMPLET DES ASSIGNATIONS")
    print("=" * 80)
    
    # Compter avant
    count_before = await db.assignations.count_documents({})
    print(f"\nüìä Assignations avant nettoyage: {count_before}")
    
    # Supprimer TOUTES les assignations
    result = await db.assignations.delete_many({})
    print(f"‚úÖ {result.deleted_count} assignations supprim√©es")
    
    # V√©rifier apr√®s
    count_after = await db.assignations.count_documents({})
    print(f"üìä Assignations apr√®s nettoyage: {count_after}")
    
    if count_after == 0:
        print("\n‚úÖ Base de donn√©es nettoy√©e avec succ√®s!")
        print("Vous pouvez maintenant relancer l'attribution automatique.")
    else:
        print(f"\n‚ö†Ô∏è Attention: Il reste {count_after} assignations")
    
    client.close()

if __name__ == "__main__":
    print("\n‚ö†Ô∏è  CE SCRIPT VA SUPPRIMER TOUTES LES ASSIGNATIONS!")
    print("Appuyez sur Entr√©e pour continuer ou Ctrl+C pour annuler...")
    input()
    asyncio.run(clean_all_assignations())
